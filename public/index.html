<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #fce4ec; /* Set a background color */
            display: flex;
            flex-direction: column;
            align-items: center; /* Center items horizontally */
            justify-content: flex-start; /* Start from the top */
            height: 100vh; /* Full height */
        }
        #canvas {
            position: fixed; /* Use fixed positioning */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; /* Send the canvas to the background */
            pointer-events: none; /* Disable pointer events on the canvas */
        }
        #fitnessText {
            border-top: 140px solid transparent; /* Create space above with a transparent border */
            border-bottom: 100px solid transparent;
            color: #1d1d1d; /* Text color */
            font-size: 32px; /* Font size */
            font-family: 'Helvetica ', sans-serif; /* Font type */
            font-weight: 500;
            letter-spacing: 18px; /* Spacing between letters */
            text-align: center; /* Center text */
            z-index: 1; /* Bring the text to the front */
        }
        .highlight {
            color: #FF9800; /* Change this to your desired color for "class" */
        }
        #goToWorkoutScreen {
            background-color: #80CBC4; /* Button color */
            color: #ffffff; /* Text color for the button */
            padding: 10px 20px; /* Add some padding to the button */
            font-size: 18px; /* Font size for the button */
            z-index: 2; /* Bring the button to the front */
            margin-top: 200px solid transparent;
            margin-bottom: 200px solid transparent; /* Space from the bottom of the screen */
            border: none; /* Remove default border */
            border-radius: 5px; /* Optional: add rounded corners */
            cursor: pointer; /* Change cursor to pointer on hover */
            
        }
        #goToWorkoutScreen:hover {
            background-color: #e68a00; /* Darker shade on hover */
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div id="fitnessText">_fitness<span class="highlight">class</span></div> <!-- Header text -->
    
    <button id="goToWorkoutScreen">View Workouts</button> <!-- Button to view workouts -->

    <script type="importmap">
        {
          "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
            "three/examples/jsm/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/"
          }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xfce4ec);
        const camera = new THREE.PerspectiveCamera(90, window.innerWidth / window.innerHeight, 0.1, 1000);

        // Define circular motion variables
        const radius = 4; // Radius of the circular path
        let angle = 1; // Initial angle for circular motion
        const speed = 0.002; // Speed of rotation
        let isOrbiting = false; // Flag to check if orbiting mode is active

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Lighting
        const light = new THREE.AmbientLight(0xffffff, 2);
        scene.add(light);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(1, 3, 2);
        scene.add(directionalLight);

        // Add back light
        const backLight = new THREE.DirectionalLight(0xffffff, 0.5);
        backLight.position.set(-1, 2, -2);
        scene.add(backLight);

        let model, mixer;

        // Load GLB Model
        const loader = new GLTFLoader();
        loader.load('lowpoly9.glb', function (gltf) {
            model = gltf.scene;
            model.position.set(0, 2, 0); // Adjusted Y position to 1.5 for centering
            model.scale.set(1.3 , 1.3 , 1.3 ); // Adjusted scale to 1 for testing
            scene.add(model);

            // Initialize mixer within the load callback
            mixer = new THREE.AnimationMixer(model);
            
            // Array of clips
            const clips = gltf.animations;
            console.log("Loaded animations:", clips); // Debugging log to see available animations
            const clip = THREE.AnimationClip.findByName(clips, 'Burpee'); // Find the clip named 'Test'
            
            if (clip) {
                const action = mixer.clipAction(clip);
                action.play(); // Play the animation
                console.log("Playing animation:", clip.name); // Debugging log
            } else {
                console.error("Clip named 'Test' not found.");
            }

        }, undefined, function (error) {
            console.error("Error loading model:", error);
        });

        const clock = new THREE.Clock(); // Moved clock initialization here
        
        animate();

        function animate() {
            requestAnimationFrame(animate); // Ensure the animation loop is continuous
            if (mixer) {
                const delta = clock.getDelta();
                mixer.update(delta); // Update the mixer for animations
            }

            if (!isOrbiting) {
                // Update camera position for horizontal circular pan
                angle += speed; // Increment the angle
                camera.position.x = radius * Math.cos(angle); // Update X position
                camera.position.z = radius * Math.sin(angle); // Update Z position
                camera.position.y = 3; // Keep the camera height constant
                camera.lookAt(0, 0, 0); // Make the camera look at the origin
            } else {
                controls.enabled = true; 
            }

            renderer.render(scene, camera);
        }

        // Event listener for the "View Workouts" button
        document.getElementById('goToWorkoutScreen').addEventListener('click', () => {
            // Navigate to the workouts screen
            window.location.href = '/workouts'; // Redirect to the /workouts endpoint
        });

        // Resize Event
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Function to update the text excerpt
        function updateTextExcerpt(title, description) {
            document.getElementById('exerciseExcerpt').querySelector('h2').innerText = title;
            document.getElementById('exerciseDescription').innerText = description;
        }

    </script>
</body>
</html>